[{"title":"Cyber Security 101 第三部分 AD和Windows基础知识","path":"/Cyber-Security-101-3/","content":"先介绍Active Directory基础知识 再介绍 Windows 的 NTFS 文件系统、UAC权限控制、系统配置、资源监控、注册表以及安全相关功能。 第一部分 Active DirectoryActive Directory是Windows服务器环境中的目录服务。几乎任何中大型企业为了集中化管理，都会部署AD 本质上 AD 是一个分层式的、分布式的数据库，用于存储、组织并提供对网络环境中各种对象和资源信息的访问。 其核心协议是实现身份认证和授权的 LDAP (Lightweight Directory Access Protocol)。 逻辑结构： 域 Domain：使用DNS域名标识，是一个安全对象的集合，这些对象共享目录数据库和安全策略 树 Tree：一个或多个域的层次化组合，这些域共享一个连续的 DNS 命名空间 林 Forest：包含一个或多个共享共同架构 (Schema) 和全局编录 (Global Catalog) 的域。林内的所有域通过可传递的信任关系自动建立双向信任。 组织单位 OU：域内组织对象的最小单位，是应用组策略和委派管理权限的最小作用域单位。 物理结构： 域控制器 DC：运行Active Directory 服务的服务器 站点 Site Active Directory用户：用户是安全主体之一，是可以对网络中的资源进行操作的对象。 人员用户：用户通常代表组织中需要访问网络的人员，例如员工。 服务用户：您还可以定义 IIS 或 MSSQL 等服务所使用的用户。每个服务都需要一个用户才能运行，但服务用户与普通用户不同，因为他们只拥有运行特定服务所需的权限。 机器：每台加入 Active Directory 域的计算机都会创建一个计算机对象。计算机也被视为“安全主体”，机器账户本身指计算机的本地管理员。通常 计算机名称+$ 就是机器账户名。 安全组：类似用户组，可用于向用户授予特定权限。如域管理员、服务器操作员、备份操作员、账户操作员、域用户、域计算机、域控制器 登录域控制器，运行 Active Directory Users and Computers 。 组织单位 OU ：容器对象，可用于对用户和计算机进行分类。一个用户一次只能属于一个 OU 如图，THM 组织单元有5个子组织单元。图中四个用户 同属于 Sales 组织单元 OU 是应用组策略和委派管理权限的最小作用域单位。 组策略销售所需要的权限是相同的，应该给销售人员统一配置权限。 根据不同需要可以给不同 OU 分别配置不同权限策略，这就是组策略。 使用Group Policy Management工具查打开 组策略 配置操作界面 在 Group Policy Objects 目录下 创建组策略，然后就可以链接到其他 组织单元 （子组织单元也会影响） 图中 GPO 内有三个组策略，已经应用于 OU Security Filtering ：安全筛选，默认情况下组策略会应用到所有安全对象 Settings 栏里可以看到具体包含哪些权限 修改组策略，右键 选中 Edit，会弹出包含许多条目的新界面，如图 组策略分发域控制器上一个名为 SYSVOL 的特定网络共享文件夹，存放有 组策略对象 数据。 DC 上的默认路径：C:\\Windows\\SYSVOL\\sysvol\\ 域内的用户可以通过 域名\\SYSVOL 来访问 域成员会定期联系 DC 查询是否 需要更新GPO 也可以在 PoweShell 使用gpupdate /force来立即更新 Delegation 权限委派授予用户特定权限，让他们能在 OU 上执行高级任务，而无需域管理员介入。 右键 需要委派给其他人的 OU，选择 Delegate Control ，进入新界面进行具体操作。 被委派的用户由于没有打开 Active Directory Users and Computers 的权限，需要使用Powershell来执行操作。 设备管理身份验证Windows域中的网络身份验证 都需要 域控制器DC 来验证配置是否正确 使用两种协议： Kerberos：新的默认协议 NetNTLM：旧的身份验证协议，仍然兼容 Kerberos使用 Kerberos 登录服务的用户将被分配 tickets ，类似cookie，持有 tickets 的用户可以出示给服务，证明已通过网络身份验证。 1.用户将 用户名和密钥 发送给 KDC（密钥分发中心），KDC 将创建并返回一个 TGT（Ticket Granting Ticket） ，这个 ticket 允许用户在每次连接服务时无需传递 用户名、密钥 即可请求服务 ticket 。 TGT 作为用户身份的通用凭证，允许用户在有效期内多次请求服务票据 服务票据则是针对特定服务的安全凭证，遵循最小权限原则，确保访问控制的精准性和安全性。 ？？？？？？？ NetNTLM？？？？？？？ 树、林、信任关系AD支持集成多个域，将网络划分为可独立管理的单元。 树的每个域都有各自的 DC ，有各自的域管理员，以及可以控制企业中所有内容的 企业管理员。 不同的命名空间 也可以 统一管理。 将多个具有不同命名空间的树合并到同一个网络中，这种结构称为林 双向信任关系是域之间的一种认证机制，允许用户跨域被识别和授权，但它本身并不自动授予资源访问权限。 管理员需要进一步配置具体的访问权限，以决定哪些用户可以访问哪些资源，从而实现安全的资源共享和跨域协作。 第二部分 文件系统与权限文件系统：NTFSNTFS 被称为日志文件系统，发生故障可以使用日志中的信息自动修复磁盘上的文件 权限设置 Read Write Read Execute List Folder Contents Modify Full Control 继承性：子文件夹和文件继承父文件夹的权限 显式权限：可以为特定文件及文件夹设置独立权限，覆盖继承的权限 备用数据流ADS每个文件至少有一个默认数据流 $DATA，ADS 允许文件附加额外的命名数据流，与主数据流并存，可以存储独立的数据。 元数据存储：Windows 常使用 ADS 存储文件的元数据，如文件的摘要信息或缩略图。 安全和隐藏数据：ADS 可用于隐藏数据（例如，恶意软件可能利用 ADS 隐藏恶意代码）。 Windows\\System32C:\\Windows 即包含操作系统的文件夹，环境变量是 %windir% 环境变量存储有关操作系统环境的信息。此信息包括操作系统路径、操作系统使用的处理器数量以及临时文件夹的位置等详细信息 其中的 System32文件夹中的内容对操作系统至关重要。 账户 管理员：可以对系统进行更改。添加用户、删除用户、修改组、修改系统设置等。 标准用户：只能更改属于用户的文件夹文件，而不能执行系统级更改，例如安装程序。 创建用户账户时会为该用户创建一个配置文件。每个用户配置文件文件夹位于 C:\\Users。 每个用户配置文件都包含共同的文件夹：桌面、文件、下载、音乐、图片 在运行窗口：lusrmgr.msc 可以查看用户和群组的详细信息。 User Account Control（UAC）任意管理员用户都可以修改系统设置，引入 UAC 以限制权限滥用。 即管理员用户登录时，默认情况下会话不会以管理员权限运行。当需要执行需要更高级别权限的操作时，系统会提示用户确认是否允许该操作运行。 不适用于内置本地管理员账户，日常不会使用这个账户。 这就是一些安装程序图标右下角会有个盾牌的原因，因为它需要更高级别的权限来安装 UAC 可以设置控制强度 运行提示符：UserAccountControlSettings.exe 设置和控制面板设置日常使用更多 控制面板可以访问更复杂设置和执行复杂操作。 任务管理器Ctrl + Shift + Esc打开任务管理器 可以查看正在运行的程序、进程，以及性能、服务等详细信息。 第三部分 系统配置及相关工具系统配置MSConfig 程序（系统配置实用程序）用于高级故障排除，主要帮助诊断启动问题。 直接Windows搜索系统配置 常规：选择Windows启动时加载的设备和服务 引导：为操作系统定义各种启动选项 服务：列出系统配置的所有服务（服务是一种在后台运行的特殊应用程序） 启动：微软建议使用任务管理器来管理启动项 工具：列出各种实用程序，可以通过运行提示符（Win+R）、命令提示符和运行按钮来启动 运行提示符：control.exe 进入控制面板 计算机管理 compmgmt.msc 计算机管理实用程序 系统工具 任务计划程序：可以创建和管理常见任务，运行应用程序、脚本等，并且可以配置任务在任意时间点运行 事件查看器：可以记录五种类型的事件。这些事件记录可以被视为审计线索，用于了解计算机系统的活动。 共享文件夹：其他人可以连接的共享和文件夹的完整列表。 本地用户和组 性能：有 性能监视器 （perfmon）程序 设备管理器：查看和配置硬件，例如禁用连接到计算机的任何硬件。 存储 磁盘管理：执行高级存储任务，设置新驱动器、扩展或缩小分区、分配或更改驱动器号 服务和应用程序：可以查看服务 系统信息 msinfo32.exe 硬件资源：不懂硬件看不懂 组件：可以查看计算机上安装的硬件设备的具体信息 软件环境：可以查看操作系统内置软件以及您已安装软件的信息。此部分还显示其他详细信息，例如环境变量和网络连接。 资源监视器 resmon.exe ？？？ 资源监视器显示每个进程以及CPU、内存、磁盘和网络使用情况的汇总信息，此外还提供有关哪些进程正在使用各个文件句柄和模块的详细信息。 高级筛选功能允许用户隔离与一个或多个进程（应用程序或服务）相关的数据，启动、停止、暂停和恢复服务，以及从用户界面关闭无响应的应用程序。它还包括一个进程分析功能，可以帮助识别死锁进程和文件锁定冲突 命令提示符 cmdhostname # 输出计算机名称 whoami # 输出登录用户的名称 ipconfig # 显示计算机的网络地址设置 cls # 清除屏幕 clear netstat # 显示协议统计信息和当前的 TCP/IP 网络连接 net # 管理网络资源 使用 help (net help) 命令后加 /? 显示说明（net除外） 注册表编辑器 regedt32.exeWindows 注册表 是一个中央分层数据库，用于存储为一个或多个用户、应用程序和硬件设备配置系统所需的信息。 注册表包含 Windows 在运行期间不断引用的信息，例如： 每个用户的个人资料 计算机上安装的应用程序以及每个应用程序可以创建的文档类型 文件夹和应用程序图标的属性表设置 系统上有哪些硬件 正在使用的端口 第四部分 内置安全功能Windows更新WIndows安全 病毒和威胁防护 防火墙和网络保护 应用程序和浏览器控制 设备安全 病毒和威胁防护防火墙防火墙（Firewall）监控和控制通过端口进出的网络流量。检查每一个数据包，决定是允许通过、拒绝，还是丢弃。 Windows防火墙提供三种防火墙配置文件：域、私有和公共 域：域配置文件适用于主机系统可以向域控制器进行身份验证的网络。 私人：私人配置文件是用户分配的配置文件，用于指定私人或家庭网络。 公共：默认配置文件是公共配置文件，用于指定公共网络，例如咖啡店、机场和其他地点的 Wi-Fi 热点。 应用和浏览器控制设备安全 内核隔离：防止攻击将代码插入高安全性进程 安全处理器：使用可信平台模块 (TPM) 技术，提供基于硬件的安全相关功能。TPM 芯片是一种安全的加密处理器。该芯片包含多种物理安全机制，使其具有防篡改功能，恶意软件无法篡改 TPM 的安全功能 数据加密：BitLocker 驱动器加密是一种与操作系统集成的数据保护功能，可以解决丢失、被盗或不当退役的计算机造成的数据盗窃或泄露威胁 卷影复制服务 VSS该服务创建数据的一致性快照（也称为卷影副本或时间点副本）。这些快照可以在特定时间点捕获文件、文件夹或整个驱动器的数据状态，方便备份或恢复。 系统保护功能：通过VSS支持创建、配置和删除还原点，以及执行系统还原。 安全风险：勒索软件可能删除卷影副本，导致无法通过系统还原恢复数据。","categories":["Cyber Security 101"]},{"title":"Cyber Security 101 第四部分 命令行","path":"/Cyber-Security-101-4/","content":"介绍Windows命令行和MS PoweShell，以及Linux操作系统中Bash的用法 cmdCMD命令属于批处理语言（Batch Script），是一种基于 Windows 命令行环境的脚本语言。 Windows环境下默认命令行解释器是 cmd.exe 基本系统信息set # 检查路径 ver # 确定操作系统版本 systeminfo # 系统信息介绍 cls # 清理cmd屏幕 # 命令 | more # 一页一页输出 网络故障排除ipconfig # 检查网络信息，后可加all ping example.com # 检查服务器是否可访问 tracert example.com # 跟踪到达目标所经过的网络路由 nslookup example.com # 查找主机域并返回其IP地址 netstat # 显示当前网络连接和监听端口 # -a显示所有已建立的连接和监听端口 # -b显示与每个监听端口和已建立的连接相关的程序 # -o显示与连接关联的进程 ID ( PID ) # -n使用数字形式表示地址和端口号 文件和磁盘管理cd # 不带参数：显示当前驱动器和目录 # 带参数（文件夹路径）：切换目录 dir # 查看子目录 # a 显示隐藏文件 # s 显示当前目录和子目录所有文件 tree # 以直观方式标识目录和子目录 mkdir # 创建目录 make rmdir # 删除目录 remove type # 查看文本文件内容 copy # 复制文件 move # 移动文件 del # 删除文件 erase # 删除文件 可以使用通配符 * 引用多个文件 # 将所有md文件复制到目录 copy *.md C:\\Markdown 任务和流程管理tasklist # 列出正在运行的进程，支持筛选 tasklist ？ # 查看帮助页面 # 查找与notepad.exe相关进程 tasklist FI imagename eq notepad.exe taskkill PID target_pid # 终止进程 其他命令chkdsk # 检查文件系统和磁盘卷 是否存在错误和坏扇区 driverquery # 显示已安装的设备驱动程序列表 sfc sacnnow # 扫描系统文件是否有损坏，并尽可能修复 shutdown ? # 关机、重启、注销等等 PowerShellPowerShell 是一种功能更强大的脚本语言，基于 .NET 框架，专为 Windows 系统管理设计。","categories":["Cyber Security 101"]},{"title":"Cyber Security 101 第二部分 Linux基础知识","path":"/Cyber-Security-101-2/","content":"介绍Linux基础知识：一些基本命令，使用SSH登录Linux设备，与文件系统交互，以及一些实用工具，进程，自动化，与包管理，日志相关知识 基本命令echo Hello # 输出提供的文本 whoami # 输出当前登录的用户 ls # 列出目录下的文件listing,默认参数是当前目录 cd # 更改目录 change directory cat # 输出文件内容 pwd # 打印完整工作目录路径 print working directory find -name passwords.txt # 在当前目录下查找文件 find -name *.txt # 使用*来搜索所有txt文件 grep \"81.143.211.90\" access.log # 搜索文件内容，展示包含所需值的条目 # shell运算符 允许终端后台允许命令 将多个命令组合在一行 > 重定向 >> 与>相同，但是输出不覆盖而是添加在后面 echo Hello > welcome # 将 Hello 输出到文本文件，内容将被覆盖 echo World >> welcome # 将 World 添加到文本文件后（自动换行） 使用SSH登录Linux设备、执行命令、与文件系统交互 SSH（Secure Shell） ：连接远程Linux机器命令行并进行交互 ssh 账户用户名@远程机器IP地址 # 然后还需输入密码 命令参数 ls -a # 将显示工作目录所有内容all，包括隐藏文件 ls --help # manual使用帮助 ls -lh # 列出当前目录下文件详细信息 long、human能阅读的方式 与文件系统交互 touch # 创建文件 mkdir # make directory创建文件夹 cp # copy mv # move rm # remove file # 确定文件类型 rm note # 删除文件 rm -R directory # 删除文件夹 cp note new_note # 复制时可以自动创建新文件 mv note new_note # 移动到新文件夹或新文件，不保留旧文件 file note # 确定文件类型 > note: ASCII text # 表明是一个文本文件 权限ls -lh > -rw-r--r-- 1 user group 4.5K Sep 2 14:30 example.txt > drwxr-xr-x 2 user group 4.0K Sep 2 10:15 mydir 第1个字符：-普通文件，d目录，l符号链接 后9个字符：权限，分为三组，分别表示 文件拥有者权限、所属组权限、其他用户权限 硬链接数（如1或2）：普通文件通常为 1，目录为至少 2（包含自身和 . 目录）。 文件拥有者、文件所属组、文件大小、最后修改时间、文件名 切换用户需要知道用户名和密码 su 其他用户 > Password: # 仅切换到目标身份，但保留当前用户的环境变量，且工作目录不变 su -l 用户名 # 完全切换用户，并切换到HOME目录 目录 ETC：存储操作系统使用的系统文件 var：存储系统上运行的服务或应用经常访问或写入的数据，如日志文件/var/log root：root系统用户的主目录 tmp：用于存储只需访问几次的数据。重启将清除，任何用户默认都可以写入此文件夹，渗透测试中存储、枚举的理想场所 终端文本编辑器nano vim 通用实用工具wgetwget 文件URL SCP（SSH）利用SSH协议在两台计算机之间传输文件，提供身份验证和加密 通过 SOURCE 和 DESTINATION 模型，SCP 允许您： 将文件和目录从当前系统复制到远程系统 scp test.txt user@IP_address:home/user/new.txt 将文件和目录从远程系统复制到当前系统 scp user@IP_address:home/user/test.txt new.txt WebPython3的“HTTPServer”会在当前目录进行文件服务 python3 -m http.server # 启动http服务（8000端口） wget http://10.10.135.215:8000/myfile 进程查看进程 所有进程（加上其他用户运行以及系统进程） ps aux top获取进程的实时统计信息 top 管理进程kill PID> 在进程被终止时可以发送的一些信号： SIGTERM——终止进程，但允许它事先执行一些清理任务 SIGKILL - 终止进程 - 事后不做任何清理 SIGSTOP——停止暂停进程 进程的启动命名空间将进程彼此隔离，只有同一命名空间中的进程可以相互看到 PID为 0 的进程是系统启动时启动的 systemd是第一个启动的进程之一，管理系统进程的初始化系统。任何想要启动的进程都会作为 systemd 的子进程启动。 systemctl 是管理 systemd 服务的命令行工具，可以用于启用或停止、开机启用、禁止 服务 systemctl [option] [service] # start stop enable disable 前台和后台在命令中添加 会让进程在后台运行 CTRL + Z也可以将进程移到后台 fg 命令将后台进程重新带回前台（ foreground） 自动化cron 是一个 Linux 系统中的守护进程（daemon），在系统启动时自动运行，用于定时执行任务（称为 cron 作业，cron jobs）。 它根据预设的时间表（schedule）运行脚本、命令或程序，适合自动化任务，如定时备份、更新系统或启动应用程序。 使用 crontab（table）来管理定时任务 crontab -e # 编辑当前用户的crontab crontab -l # 查看当前用户的crontab 格式 时 日 月 星期 命令 # *表示任意 0 * * * * /usr/bin/google-chrome # 每个小时启动Google Chrome @reboot /var/opt/processes.sh # 系统启动或重启时执行脚本 包管理??????apt 是软件包管理命令，每当更新系统时，包含软件的仓库也会检查更新 apt update apt install [software-name-here] apt remove [software-name-here] 日志 varlogvar/log 存储各种日志 日志轮转：自动管理日志文件大小和存储，定期压缩旧日志、创建新日志、并删除过期日志 以三个日志为例： Apache2 Web服务器： /var/log/apache2/access.log：记录 Web 服务器的访问日志（每次 HTTP 请求的详细信息，如 IP、URL、状态码等）。 /var/log/apache2/error.log：记录 Apache2 的错误信息（如配置错误、页面未找到）。 fail2ban 服务：/var/log/fail2ban.log，记录 fail2ban 服务的运行状态和操作。 防止暴力破解，通过监控日志（如SSH登录）检测异常行为，并临时封禁异常IP UFW服务：/var/log/ufw.log，记录 UFW 防火墙的操作和事件。","categories":["Cyber Security 101"]},{"title":"Cyber Security 101 第一部分 简介","path":"/Cyber-Security-101-1/","content":"简单介绍进攻性安全和防御性安全，总结搜索技巧 进攻性安全：模拟黑客查找系统漏洞示例：入侵一个 FakeBank -u 声明正在扫描的网站 -w 采用单词列表遍历查找隐藏的页面 这里扫描了一个模拟的银行网站，http://fakebank.thm 结果找到bank-transfer转账页面，状态200 OK，代表可以访问 访问http://fakebank.thm/bank-transfer 于是获取了转账权限（可以使用ID进行转账） 总结： 未经授权就可以访问的转账页面，这是一种访问控制漏洞。具体来说是不安全的直接引用 通过操纵 URL 参数、表单数据或请求体中的标识符（如用户 ID、账户 ID 或交易 ID） 无需授权，直接访问或修改他人的资源 修复漏洞需要实施严格的访问控制检查 Optus 数据泄露（2022 年，澳大利亚电信巨头） https://www.upguard.com/blog/how-did-the-optus-data-breach-happen 报告总结了原因： 一个无需身份验证的API可以访问客户敏感信息 递增使用客户标识符（递增ID即可获取所有客户ID） GobusterGo语言编写的开源命令行工具 可以用于暴力枚举Web目录、文件、DNS子域名等 gobuster dir -u 网站域名 -w 爆破字典 gobuster dns -d 网站域名 -w 爆破字典 防御安全简介：从防御、维护的角度 Security Operations Center (SOC), where we cover Threat Intelligence 情报收集 Digital Forensics and Incident Response (DFIR), where we also cover Malware Analysis 数字取证、事件响应、恶意软件分析 事件响应流程： Security Information and Event Management (SIEM) 系统 是一种集成的安全管理方案， 收集安全相关信息和事件并呈现，如果检测到可疑事件会发出警报 SIEM系统模拟： 多次登录失败不一定有问题，可能只是忘记密码 注意到 IP 143.110.250.149 尝试未授权登录，最终成功，这很可疑，利用一些网站查询IP是否可疑。 查询结果显示非常可疑，并且登录成功，可能有危险，应该进行处理。选择 SOC Team lead ，负责初始的事件处理并报告，之后交给 DFIR 最后封锁这个IP 搜索技巧谷歌搜索: 双引号表示精确搜索 site: 限制域名 - 忽略特定词语 filetype:查找文件类型（而非网页） 专业搜索引擎： Shodan 搜索联网设备 Censys 搜索互联网资产 VirusTotal 文件病毒扫描服务 Have I Been Pwned 检测某个电子邮箱地址是否被泄露 常见漏洞CVE CVE系统，漏洞字典，用CVE ID标准化每个漏洞（https://nvd.nist.gov/） 漏洞数据库，可以找到来自不同作者的漏洞利用代码 查阅官方文档","categories":["Cyber Security 101"]}]